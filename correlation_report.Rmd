
---
title: "Biểu đồ tương quan SO_NGAY_KHOI và COI_NS1"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
```

# Đọc dữ liệu
```{r}
df <- read.csv("NS1_Biosensor_no_diacritics.csv", stringsAsFactors = FALSE)
df_cor <- df %>%
  filter(!is.na(SO_NGAY_KHOI), !is.na(COI_NS1))
```

# Tính Pearson correlation
```{r}
test_cor <- cor.test(df_cor$SO_NGAY_KHOI, df_cor$COI_NS1, method = "pearson")
r_val <- round(test_cor$estimate, 3)
p_val <- signif(test_cor$p.value, 3)
```

# Vẽ biểu đồ tương quan
```{r}
ggplot(df_cor, aes(x = SO_NGAY_KHOI, y = COI_NS1)) +
  geom_point(alpha = 0.6, color = "#2C7BB6") +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  annotate("text",
           x = max(df_cor$SO_NGAY_KHOI, na.rm = TRUE),
           y = max(df_cor$COI_NS1, na.rm = TRUE),
           label = paste0("r = ", r_val, "\np = ", p_val),
           hjust = 1, vjust = 1, size = 5) +
  labs(
    title = "Tương quan giữa Số Ngày Khởi Bệnh và COI NS1",
    x = "Số ngày khởi bệnh (SO_NGAY_KHOI)",
    y = "Chỉ số COI NS1 (COI_NS1)"
  ) +
  theme_minimal(base_size = 14)
```
